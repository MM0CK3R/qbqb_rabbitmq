# fuzzing 관련 논문 분석

## 아래한글 신규 취약점 발견을 위한 fuzzing 기법 개발에 관한 연구

논문 출처: 성균관대학교 일반대학원: 전자전기컴퓨터공학과 2015.2 안성환

해당 논문은 국내 기관에서 의무적으로 사용하는 한글 워드프로세서의 신규 취약점을 발견하기 위해 퍼징 기법을 제안한다. 윈도우에서의 아래 한글 2010 프로그램에 입력되는 HWP 문서 파일을 통한 fuzzing에 대해 설명한다. 퍼징 도구로 Peach Fuzzing Framework를 사용하며, python으로 fuzzing 툴을 작성하여 사용 실험한다.

목차

0. 논문요약

1. 서론
2. 관련 연구
   1. 소프트웨어 보안 취약점
   2. 소프트웨어 보안 테스팅
3. 데이터 레코드 기반 퍼징
   1. 한글 파일 구조 분석
   2. 아래한글 취약점 발견 퍼징 기법
4. 실험 및 결과
5. 결론



### 0. 논문요약

- 기존

  퍼징 대상이 되는 소프트웨어와 데이터 모델을 분석하여 취약점이 발생할 가능성이 있는 부분의 값을 무작위로 대입하면서 수행하는 것에 많은 시간과 자원이 소모된다.

- 논문 기존 문제 대책 방안

  단순한 무작위 입력을 대입하는 것이 아닌 데이터 스트림의 구조에서 실제 데이터 부분의 위치를 교환하여 퍼징하는 기법을 제안하고 구현한다.

- 방안을 통한 결과

  한글 워드프로세서 신규 취약점 발견 및 사이버 보안에 기여

### 1. 서론

- 동향

  최근 APT(Advanced Persistent Threat) 공격의 대상이 되는 기관/기업들은 일반적으로 보안 솔루션들을 갖추고 있기 때문에 공격자들은 직접 목표 내부 네트워크로 침투하는 방법보다 내부자를 대상으로 이메일과 메신저를 통해 악성코드가 담긴 웹사이트의 링크를 보내거나 스팸, 피싱 등의 수법을 이용하여 내부 PC에 악성코드 유포하고 내부 네트워크를 해킹하여 공격을 개시한다. 하지만 악성코드 유포지에서 실행코드를 직접 첨부하는 경우엔 Anti-Virus 솔루션이 탐지 할 수 있으므로 이를 우회하기 위해 오피스 프로그램의 알려지지 않은 취약점을 통해 정상 문서로 위조하여 내부자로 하여금 악성코드를 다운받고 실행하도록 한다.

  - 예

    - 2011년 EMC/RSA사의 OTP 기밀정보 유출 사고

      Adobe Flash Player의 알려지지 않은 취약점을 이용한 제로데이 공격

  - 국내

    국가기관 및 군대, 기업에서 아래한글 프로그램을 의무적으로 사용하므로 이를 통한 공격 시도가 많다.

    "2014 국가 정보보호 백서"에 따르면 아래한글 취약점을 악용해 악성코드를 포함한 HWP 파일은 13년7월 부터 12월까지 14차례 발생하였다. 이는 맞춤형 메일을 통해 악성코드를 전파하였다.

    따라서 국가기관 및 군대, 기업에서의 대규모 피해를 방지하는것은 매우 중요하다.

- 기존의 퍼징 방법

  덤(Dumb) 퍼징과 스마트(Smart) 퍼징, 생성(Generation), 변형(Mutation) 등은 샘플 파일의 분석을 선행한 후 취약점이 존재할 법한 부분의 데이터를 무작위로 변경하는데 초점은 둔다.

- 제안하는 퍼징 방법

  본 논문에서는 무작위 데이터를 입력하는 퍼징방법에서 벗어나 아래한글의 신규 취약점을 찾기 위해 한글 파일의 구조를 면밀히 파악하고 해당 구조에서 내부 데이터의 위치를 교환하는 기법을 이용하여 보안 테스팅을 수행하는 방법을 제안한다.

  파일 내의 여러 필드들을 묶어 레코드로 처리하는 아래한글의 특징적인 파일 구조를 대상으로 실제 데이터 표현 부분을 뒤섰어 테스팅을 수행한다. 또한 한글 문서 샘플 파일의 구조를 자동적으로 분석하여 퍼징에 필요한 정보를 추출하는 것을 자동화한다.

  

### 2. 관련 연구

#### 1. 소프트웨어 보안 취약점

소프트웨어 보안 취약점은 일반적으로 소프트웨어 개발 시 잘못된 코딩, 버그, 예외 처리를 하지 않는 경우 발생한다. 

- 보안 취약점 발생 이유

  - 개발자는 습관적으로 동일한 코딩 기법을 사용하여 S/W를 개발하기 때문에 한 프로그램에서 취약점이 발견되면 그와 유사한 취약점들이 계속해서 발생한다.
  - 개발 단계에서 보안을 고려하지 않거나 개발 기간에 쫓겨 보안 요소를 간과 하고 개발하여 구조적으로 보안 취약점을 가진다.

- 보안 취약점의 정의

  - RFC2828

    시스템의 설계, 구현, 운용 또는 관리 단계에 존재하는 결점 또는 약점

  - NIST

    우연히 발견되거나 고의로 악용되어 보안 침해나 시스템 보안 정책의 위배를 초래할 수 있는 시스템 보안 절차, 설계, 구현 또는 내부제어 등에서의 결점 또는 약점

- 보안 취약점의 방지

  - 시큐어 코딩, 설계 단계에서 부터 보안 강조

  그러나 여전히 취약점은 발견되고 있다.

- S/W 보안 문제가 지속적으로 발생하는 이유(McGraw)

  - 연결성(Connectivity)
    -  많은 장치들이 유,무선 인터넷으로 연결되어 있어 공격 루트가 늘어나고 자동화된 공격 도구가 증가함에 따라 S/W 취약점 공격 대응이 어렵다.
  - 확장성(Extensibility)
    - 플러그인, 모듈과 같이 확장성을 가지는 S/W의 경우 새로운 기능을 추가하거나, 사용자 니즈에 맞는 유연한 인터페이스를 제공하기에는 적합하나 확장된 프로그램에 의해 발생되는 S/W 취약점은 방어하기 어렵다.
  - 복잡성(Complexity)
    - S/W가 다양한 기능을 수행함에 따라 그 크기와 복잡성이 계속 증가하게 된다는 점이다.
      대규모 S/W의 경우 일반적으로 팀 단위로 개발을 하게 되고 소스 코드의 라인 수도 수만~ 수백만 라인에 이른다. 코드의 라인이 많아질수록 잘못된 코딩으로 인한 버그 가능성이 높아지며 이는 잠재적인 취약점이 된다.

#### 2. S/W 보안 테스팅

S/W 보안 테스팅은 개발된 S/W의 안정성을 확인하여 악용 가능성의 보안 취약점을이 발견될 가능성을 미리 줄이는 방법 중에 하나이다.

- 보안 테스팅의 목적

  1. S/W가 배포되기 전에 제품의 강인함과 보안성을 확인하여 S/W를 보증하기 위한 개발 과정의 하나
  2. S/W가 배포된 이후에 미처 발견하지 못한 취약점을 발견하여 패치를 통해 S/W의 안정성을 높이는데 사용

- 보안 테스팅 확인 사항

  - 소프트웨어 설계과정에서 명시된 보안 제약 사항들을 위배하지 않는지 체크
  - 소프트웨어의 기능이 예측가능하고 안전한지 체크
  - 해당 소프트웨어의 취약점이나 약점을 들어내는지 여부 확인
  - 소프트웨어의 오류와 에외 핸들링이 적절하게 되어 안전한 실행상태 유지 여부 확인

- 보안 테스팅의 분류

  - 화이트박스 테스트
    - 소프트웨어 개발사에서 내부 소스 코드레벨에서 프로그램의 기능을 점검하는 테스트
  - 블랙박스 테스트
    - 소프트웨어의 내부 구조나 소스를 보지 않고 입력 값과 출력 값을 확인하여 보안 결함이 있는지 점검하는 테스트
  - 그레이박스 테스트
    - 소프트웨어의 내부 소스 코드는 보지 않지만 설계, 입력 값의 구조 등과 같은 일부 정보를 아는 상태에서 검사하는 테스트

- 소프트웨어의 실행 여부에 따른 보안 테스팅의 분류

  - 정적 분석(Static Analysis)

    프로그램을 실행하지 않고 확보된 코드나 설계 수준에서 취약점을 살피는 방법

  - 동적 분석(Dynamic Analysis)

    실제 프로그램의 실행을 통해 입력 값에 대한 반응을 살펴 취약점을 발견하는 방법

- 보안테스팅 방법

  1. 위험 분석(Risk Analysis)

     소프트웨어 설계 단계의 보안 요구사항들을 검토하고 보안 위험들을 식별하기 위한 방법

     - 보안 요구사항은 위협 평가를 위한 위협 모델 NIST의 800-30 표준을 따른다.
       1. 프로그램에 대해 공격과 같은 악조건 하에서도 S/W가 지속적으로 신뢰성있게 동작을 하는지 여부를 검증
       2. S/W 취약점을 사전에 검토함으로써 안전한 행위 및 상태 변화를 수행하는 측면에서 신뢰성을 검증
       3. S/W의 이상상태, 오류, 예외를 정확하게 인지할 수 있고 안전하게 핸들링 할 수 있음을 보장함으로써 S/W 생존성을 검증

  2. 코드 검토(Code Review)

     코드 검토는 주로 S/W의 구현 단계에서 소스 코드의 보안 취약점을 수동으로 검사하는 과정

     S/W를 실행하지 않고 주어진 코드를 분석하는 방법으로 정적 분석 방법이며, 소스코드를 확보한 상태에서 분석을 수행하는 것이므로 화이트박스 테스트이다.

     - 장점

       블랙박스 테스팅과는 다르게 정확하게 결함의 위치 파악 가능

     - 단점

       대규모 S/W의 경우 코드를 수동으로 검토하기에 실질적으로 효율적이지 못하고, 분석가의 순련도에 테스트 결과가 의존. 또한 런타임 에러 발견하기에는 부적절

  3. 오염 분석(Taint Analysis)

     오염 분석은 프로그램의 실행 시에 외부로부터 입력되는 데이터를 오염된것으로 판단한 뒤, 이것이 악의적인 목적 또는 핸들링되지 않는 오류를 발생시키는데 쓰였는지를 데이터의 흐름을 추적하여 분석하는 방법

     즉, 모든 입력을 비 신뢰적인 값으로 간주하고 이들 데이터가 어떻게 처리되고 있는지 데이터의 흐름을 추적하는 방법

     적적/동적 분석 모두 가능하며, 정적 오염 분석의 경우 해당 S?W가 동적으로 코드를 생성 실행하는 경우 실행 코드가 안전한지 판단하기 어렵고 오탐을 발생시킬 가능성이 높다. 또한 명시적으로 오류를 일으킬 가능성이 높은 부분에 대해 미리 정보를 수집해 놓아야 하지만 프로그램의 언어, 코딩 스타일에 따라 달리 해야하므로 현재 동적 오염분석의 일부분으로 사용된다. 동적 오염 분석은 타깃 프로그램을 직접 실행시키면서 오염된 데이터 흐름을 추적하는 방법이다. 생성되는 코드와 같은 암시적인 데이터 흐름도 검사할 수 있는 장점이 있다. 또한 PIN과 같은 도구를 통해 실행하고 있는 어셈블리 코드 단위로 추적이 가능하다. 

     - 단점

       프로그램의 분석 시간이 다른 방법들에 비해 상대적으로 길고 구현이 정적 오염 분석 보다 어려움

  4. 퍼징(Fuzz Testing, Fuzzing)

     Wisconsin-Madison에서 1989년에 제안된 퍼징은 블랙박스 테스트에 해당하고 매우 심플한 S/W 테스트 방법이다. 프로그램의 실행 시 무작위 데이터를 입력하여 기능을 테스트 하는 것이다. 무작위 데이터를 입력하여 프로그램이 정상적으로 동작되지 않는다면 해당 프로그램에 결함이 있다는 것을 의미한다. S/W 개발이 완료된 이후 프로그램의 취약점을 발견하고 패치하기 위해 퍼징을 이용한다.

     - 퍼징을 이용한 프로그램 취약점 발견과정

       1. 프로그램 식별
       2. 입력 데이터 식별
       3. 무작위 데이터 생성
       4. 무작위 데이터 입력
       5. 프로그램 상태 감시
       6. 공격 가능성 판단

       먼저 취약점을 발견하려 하는 대상 프로그램을 식별하고 해당 프로그램의 입력 데이터(키보드, 파일, 입력 등)를 식별한다. 이후 정상 입력 데이터를 기반으로 그 중 일부 데이터를 무작위로 변경하는 방법으로 데이터를 생성하는가의 여부에 따라 무작위 데이터 또는 부분적으로 유효한 데이터가 이용 될 수도 있다. 데이터를 생성한 후 변경된 데이터를 실행되는 프로그램에 입력하고 상태를 모니터링한다. 모니터링 결과 Hang 또는 Crash가 발생하는 경우 입력된 데이터와 범용 레지스터 상태, 힙, 스택 정보 등을 로그로 남긴다. 이후 디버깅을 통해 힙 오버플로우, 스택 오버플로우등 임의 코드 실행 공격으로 이어질 수 있는지 여부를 확인하는 검증과정을 수행한다.

     - 퍼징 기법의 분류

       - 퍼징 대상의 이해 유무에 따른 분류

         - 덤(Dumb)

           퍼징 대상에 대한 기반 지식 없이 무작위 데이터를 입력하여 테스트 하는 방법

         - 스마트(Smart)

           퍼징 대상의 입력 데이터의 구조와 프로그램에서 데이터를 처리하기 위한 방법 등을 사전에 알고 있는 상태에서 테스트를 수행하는 방법

       - 데이터 처리 방법에 따른 분류

         - 생성(Generation)

           퍼징에 필요한 데이터를 만들어서 입력하는 방법

         - 변형(Mutation)

           퍼징에 필요한 데이터를 기존의 올바른 샘플에서 데이터의 일부를 변형시켜 입력하는 방법

     - 퍼징 도구의 분류

       1. FileFuzz
       2. beSTORM
       3. Peach Fuzzing Framework

